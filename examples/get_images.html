<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/style.css">
    <script
            async
            src="{TD_URL}/js/website-integration.js"
            referrerpolicy="origin"
            data-td-api="{TD_URL}/api"
            data-td-api-key="{TD_API_KEY}"
            data-td-script-initialized-callback="td_onInitialized"
    ></script>
    <script>
        function td_onInitialized () {
            console.log('td_onInitialized called');

            window.tronDesigner.subscribeDesignerEvent("printJob", "created", (event) => {
                console.log("Print Job Created:");
                console.log(event);
                if (event.entityType !== "printJob") {
                    console.error("Unexpected entity type:", event.entityType);
                    return;
                }

                const printJob = event.detail;
                const printJobGuid = printJob.printJobGuid;
                printJob.printings.forEach((p) => {
                    console.log(`printing Guid: ${p.printingGuid}`);
                    // get motive area image
                    window.tronDesigner.getPrintingMotive(printJobGuid, p.printingGuid).then((imageData) => {
                        // imageData is a Blob containing the motive area image
                        console.log(`Motive area image data for printing ${p.printingGuid}:`, imageData);
                        const imgURL = URL.createObjectURL(imageData);
                        // find img element by id and set src
                        const imgElement = document.getElementById('MotiveAreaImage');
                        imgElement.src = imgURL;
                        imgElement.alt = `Motive area for printing ${p.printingGuid}`;
                    }).catch((error) => {
                        console.error(`Error fetching motive area image for printing ${p.printingGuid}:`, error);
                    });

                    // get printing visualization image
                    window.tronDesigner.getPrintingImage(printJobGuid, p.printingGuid).then((imageData) => {
                        // imageData is a Blob containing the visualization image
                        console.log(`Visualization image data for printing ${p.printingGuid}:`, imageData);
                        const imgURL = URL.createObjectURL(imageData);
                        // find img element by id and set src
                        const imgElement = document.getElementById('VisualizationImage');
                        imgElement.src = imgURL;
                        imgElement.alt = `Visualization image for printing ${p.printingGuid}`;
                    }).catch((error) => {
                        console.error(`Error fetching motive area image for printing ${p.printingGuid}:`, error);
                    });
                })
            });
            console.log("Subscribed to 'printJob created' event.");
        }
    </script>
    <title>Tron Designer Integration - Get Images</title>
</head>
<body>
<div class="header">
    <div><a href="https://www.trondesigner.com"><img src="https://cdn-webassets.promotron.com/images/td/logo-full-light-theme.svg" class="logo"></a></div>
    <h1>
        <span>TronDesigner</span> - Integration Examples<br>
        <small>Docs:
            <a href="https://help.promotron.com/en/help/articles/5362575-integration-scenarios" target="_blank">Scenarios</a> &nbsp;|&nbsp;
            <a href="https://help.promotron.com/en/help/articles/8234354-integration-logic" target="_blank">Modes</a> &nbsp;|&nbsp;
            <a href="https://help.promotron.com/en/help/collections/5977087-developer-guide" target="_blank">Developer Guide</a>
        </small>
    </h1>
    <a href="index.html">Back to examples</a>
</div>
<div class="example">
    <img src="https://troncloudprod.blob.core.windows.net/mockup-preview-images/0c090d99-b8bf-4dcc-bf6f-119c7907845a" alt="Oregon 400 ml - Blue Cloud"/>
    <div class="actions">
        <button class="btn"
                data-td-action="OpenCreate"
                data-td-supplier-code="PFC"
                data-td-product-code="10086052"
                data-td-print-position-code="front"
                data-td-print-technology-code="PAD03">
            Open Designer
            <br>
            <small>Oregon 400 ml - Blue Cloud</small>
        </button>
    </div>
</div>
<div class="example">
    <h4>Get Printing Images Example</h4>
    <div style="display: flex; gap: 20px;">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <img id="MotiveAreaImage" src="https://placehold.co/400x400?text=Waiting+for+Print+Job+Creation" alt="Waiting for Print Job Creation" style="max-width: 400px; max-height: 400px;">
            <small>Motive Area Image</small>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
            <img id="VisualizationImage" src="https://placehold.co/400x400?text=Waiting+for+Print+Job+Creation" alt="Waiting for Print Job Creation" style="max-width: 400px; max-height: 400px;">
            <small>Visualization Image</small>
        </div>
    </div>
</div>
</body>
</html>
